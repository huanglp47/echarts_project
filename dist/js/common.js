$(function(){$.yyting={ajax:function(e){$.ajax(e)},parseURL:function(e){for(var t,a={},r=/([^?=&]+)=([^&]+)/gi;null!=(t=r.exec(e));)a[t[1]]=t[2];return a}};var e,t,a,r,i,n,s,o,l,c,d,h;$.echarts={table2JSON:function(e){var t={};return t.tableHeadData=e.legend.data,"line"==o?t.firstColumnData=e.xAxis[0].data:"pie"==o&&(t.firstColumnData=[s[0].name]),t.columnData=$.echarts.formSeriesMap(e.series,o),JSON.stringify(t)},getDataViewHtml:function(e){var t=[];if(e.xAxis&&e.xAxis.data)for(var a in e.xAxis.data)t.push(e.xAxis.data[a]);else t.push(e.series[0].name);var t=e.legend.data,r=$.echarts.formSeriesMap(e.series,o),i='<div class="row"><div class="table-responsive"><table class="table table-bordered"><thead><th>&nbsp;</th>';for(var a in e.legend.data)i=i+"<th>"+e.legend.data[a]+"</th>";if(i+="</thead><tbody>","line"==o)for(var a=0;a<e.xAxis[0].data.length;a++){i+="<tr>",i=i+"<td>"+e.xAxis[0].data[a]+"</td>";for(var n in e.legend.data)i=i+"<td>"+r[e.legend.data[n]].data[a]+"</td>";i+="</tr>"}else if("pie"==o){i+="<tr>",i=i+"<td>"+s[0].name+"</td>";for(var n in e.legend.data)i=i+"<td>"+r[e.legend.data[n]].value+"</td>";i+="</tr>"}return i+="</tbody></table></div></div>"},createOption:function(e,t,a,r,u,p){var g=[],f={};"line"==o?(f={line:"线形图切换",bar:"柱状图切换"},g=["line","bar"]):"pie"==o&&(f={pie:"饼图切换"},g=["pie"]);var v={};v.dataZoom={show:!0,title:{dataZoom:"区域缩放",dataZoomReset:"区域缩放后退"}},v.changeLine={show:!0,title:"切换线图",icon:"/assets/images/line-chart.png",onclick:function(){o="line",$.echarts.createLineChart(i,l)}},v.changeBar={show:!0,title:"切换柱图",icon:"/assets/images/bar-chart.png",onclick:function(){o="line",$.echarts.createBarChart(i,l)}},c&&(v.changePie={show:!0,title:"切换饼图",icon:"/assets/images/pie-chart.png",onclick:function(){o="pie",$.echarts.createPieChart(i,l)}}),v.restore={show:!0,title:"还原"},v.saveAsImage={show:!0,title:"保存为图片",type:"jpg",lang:["点击保存"]};var m={};m.show=!0,m.orient="horizontal",m.feature=v;var w={};w.x=d,w.y=h,w.padding=0,w.data=t,w.orient=r?"vertical":"horizontal";var D={};return D.title={text:u},D.tooltip={show:!0,trigger:"line"==o?"axis":"item"},"pie"==o&&(D.tooltip.formatter="{a} <br/>{b} : {c} ({d}%)"),D.toolbox=m,D.legend=w,"line"==o&&(D.xAxis=[{type:"category",axisLabel:{interval:0,rotate:60},data:p}],D.yAxis={type:"value",axisLabel:{interval:0},min:0}),D.series=e,n=D,s=e,D},formSeriesMap:function(e,t){var a={};if("line"==o)for(var r in e)a[e[r].name]=e[r];else if("pie"==o)for(var r in e[0].data)a[e[0].data[r].name]=e[0].data[r];return a},createLineChart:function(e,t){$.echarts.createLineBarChart(e,"line",t)},createBarChart:function(e){$.echarts.createLineBarChart(e,"bar",l)},fillSeriesDataType:function(e,t){for(var a in e)e[a].type=t;return e},createLineBarChart:function(e,t,a){e.clear();var r=$.echarts.fillSeriesDataType(a.lineSeries,t),i=a.lineLegendData,n=[],s=a.xAxisData,o=a.titleText,l=$.echarts.createOption(r,i,n,!1,o,s);e.setOption(l)},createPieChart:function(e,t){e.clear();var a=$.echarts.fillSeriesDataType(t.pieSeries,"pie"),r=t.pieLegendData,i=[],n=t.title,s=$.echarts.createOption(a,r,i,!0,n);e.setOption(s)},getObjFieldCount:function(e){var t=0;for(var a in e)t++;return t},clearCharts:function(){i&&i.clear()},getDateValue:function(e,t){var a=new Date;e||(e=0);var r=$.echarts.dateAdd(a,"d",e),i=r.getMonth()+1;10>i&&(i="0"+i);var n=r.getDate();return 10>n&&(n="0"+n),t?r.getFullYear()+""+i+n:r.getFullYear()+""+i},dateAdd:function(e,t,a){var r=e;switch(t){case"s":return new Date(Date.parse(r)+1e3*a);case"n":return new Date(Date.parse(r)+6e4*a);case"h":return new Date(Date.parse(r)+36e5*a);case"d":return new Date(Date.parse(r)+864e5*a);case"w":return new Date(Date.parse(r)+6048e5*a);case"q":return new Date(r.getFullYear(),r.getMonth()+3*a,r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());case"m":return new Date(r.getFullYear(),r.getMonth()+a,r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());case"y":return new Date(r.getFullYear()+a,r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds())}},init:function(u){if(e=u.mainChartId||"main",t=u.changeChartId||"changeChart",a=u.downloadDataId||"downloadData",r=u.dataViewId||"dataView",n=null,s=null,o=u.currentType||"line",d=u.xPos||0,h=u.yPos||0,i=echarts.init(document.getElementById(e)),$("#"+t).on("click",function(){var t=$(this).attr("data-showView");t||$(this).attr("data-showView","off"),"on"==t?($("#"+e).show(),$("#"+r).hide(),$("#"+a).hide(),$(this).attr("data-showView","off"),$(this).html("查看数据")):"off"==t&&($("#"+e).hide(),$("#"+r).html($.echarts.getDataViewHtml(n)),$("#"+r).show(),$("#"+a).show(),$(this).attr("data-showView","on"),$(this).html("查看图表"))}),$("#"+a).on("click",function(){var e=$("<form>");e.attr("style","display:none"),e.attr("target","_blank"),e.attr("method","post"),e.attr("action","/export/excel");var t=$("<input>");t.attr("type","hidden"),t.attr("name","jsonData"),t.attr("value",$.echarts.table2JSON(n)),$("body").append(e),e.append(t),e.submit(),e.remove()}),u.series){var p=[],g=[],f=[],v={},m=[],w=[],D="",x=[],b=0;for(var y in u.series){0==b&&(c=1==$.echarts.getObjFieldCount(u.series[y])),c&&m.push(y),p.push(y);for(var C in u.series[y])c&&(0==b&&(D=C),x.push({value:u.series[y][C],name:y})),0==b&&g.push(C),v[C]||(v[C]=[]),v[C].push(u.series[y][C]);b++}for(var y in g)f.push({name:g[y],type:"line"==o||"bar"==o?o:"line",data:v[g[y]]});c&&w.push({name:D,type:"pie",radius:"55%",center:["50%","60%"],data:x}),l=u.series,l.lineLegendData=g,l.lineSeries=f,c&&(l.pieLegendData=m,l.pieSeries=w),("line"==o||"bar"==o)&&(l.xAxisData=p),"line"==o?$.echarts.createLineChart(i,l):"bar"==o?$.echarts.createBarChart(i,l):"pie"==o&&$.echarts.createPieChart(i,l)}}},$.yyting.params=$.yyting.parseURL(location.href)});